{"version":3,"file":"rainCore.min.js","sources":["../src/reactivity/utils.ts","../src/reactivity/effect.ts","../src/reactivity/reactive.ts","../src/reactivity/ref.ts","../src/reactivity/watchEffect.ts","../src/reactivity/watch.ts","../src/reactivity/computed.ts","../src/runtime/utils.ts","../src/runtime/vnode.ts","../src/runtime/mount.ts","../src/runtime/process.ts","../src/runtime/unmount.ts","../src/runtime/patch.ts","../src/runtime/render.ts"],"sourcesContent":["/* reactive 响应式标识 */\r\nexport const IS_REACTIVE: string = '__isReactive'\r\n/* reactive 响应式标识 */\r\nexport const IS_REF: string = '__isRef'\r\n/* 代理前对象标识 */\r\nexport const RAW: string = '__raw'\r\n\r\n/* 判断是否是对象 */\r\nexport function isObject(target: any) {\r\n    return typeof target === 'object' && target != null\r\n}\r\n\r\n/* 判断是否是数组 */\r\nexport function isArray(target: any) {\r\n    return Array.isArray(target)\r\n}\r\n\r\n/* 判断是否是函数 */\r\nexport function isFunction(target: any) {\r\n    return typeof target === 'function' && target != null\r\n}\r\n\r\n/* 判断是否是 reactive 响应式对象 */\r\nexport function isReactive(target: any) {\r\n    return !!(target && target[IS_REACTIVE])\r\n\r\n}\r\n\r\n/* 判断是否是 ref 响应式对象 */\r\nexport function isRef(value: any) {\r\n    return !!(value && value[IS_REF])\r\n}\r\n\r\n/* 判断两个值是否一致 */\r\nexport function hasChanged(oldValue: any, newValue: any) {\r\n    return oldValue !== newValue && !(Number.isNaN(oldValue) || Number.isNaN(newValue))\r\n}","const effectStack: any = []\r\n/* 暴露依赖 */\r\nlet activeEffect: any\r\n\r\nfunction effect(func: Function, options: any = {}): Function {\r\n    const effectFn = () => {\r\n        try {\r\n            effectStack.push(effectFn)\r\n            activeEffect = effectFn\r\n            return func()\r\n        } finally {\r\n            effectStack.pop()\r\n            activeEffect = effectStack[effectStack.length - 1]\r\n        }\r\n    }\r\n    /* 是否先执行一次 */\r\n    if (!options.lazy) effectFn()\r\n\r\n    effectFn.scheduler = options.scheduler\r\n\r\n    return effectFn\r\n}\r\n\r\n/* 收集依赖 */\r\nconst targetMap: WeakMap<object, any> = new WeakMap()\r\n\r\nfunction track(target: any, key: string | symbol): void {\r\n    /* 是否有依赖需要收集 没有直接发返回 */\r\n    if (!activeEffect) return\r\n    /* \r\n        查找是否有此响应式数据对应的依赖组 \r\n        如果没有为该数据创建 Map \r\n    */\r\n    let depsMap = targetMap.get(target)\r\n    if (!depsMap) targetMap.set(target, (depsMap = new Map()))\r\n    /* \r\n        查找是否有此响应式数据内数据的依赖组 \r\n        如果没有为该数据创建 Set \r\n    */\r\n    let deps = depsMap.get(key)\r\n    if (!deps) depsMap.set(key, (deps = new Set()))\r\n    /* 把用到此数据的依赖挂载到 effectFn 上 提供删除 */\r\n    activeEffect.deps = deps\r\n    /* 添加依赖 */\r\n    deps.add(activeEffect)\r\n}\r\n\r\n/* 触发依赖 */\r\nfunction trigger(target: any, key: string | symbol, value?: any): void {\r\n    const depsMap = targetMap.get(target)\r\n    /* \r\n        查找是否有此响应式数据对应的依赖组 \r\n        没有就直接返回\r\n    */\r\n    if (!depsMap) return\r\n    /* \r\n       查找是否有此响应式数据内数据的依赖组 \r\n       没有就直接返回\r\n    */\r\n    const deps = depsMap.get(key)\r\n    if (!deps) return\r\n    /* 触发依赖 */\r\n    deps.forEach((effect: { (): any; scheduler: (effect: any, value: any) => any }) => {\r\n        /* 有调度 scheduler 优先触发 scheduler */\r\n        effect.scheduler ? effect.scheduler(effect, value) : effect()\r\n    })\r\n}\r\n\r\nexport { effect, track, trigger, targetMap }","import { IS_REACTIVE, RAW, isObject, isArray, isReactive, hasChanged } from './utils'\r\nimport { track, trigger } from './effect'\r\n\r\n/* 保存响应式对象 */\r\nconst reactiveMap = new WeakMap()\r\n\r\nfunction reactive(target: any) {\r\n    /* 如果不是对象直接返回 */\r\n    if (!isObject(target)) return target\r\n    /* 是否已经是响应式对象 如果是直接返回 */\r\n    if (isReactive(target)) return target\r\n    /* 如果对象已经做过响应式 就直接返沪响应式对象 */\r\n    if (reactiveMap.has(target)) return reactiveMap.get(target)\r\n    /* 创建响应式对象 */\r\n    return createReactiveObject(target)\r\n}\r\n\r\n/* 提供一个响应式对象，返回原始对象 */\r\nfunction toRaw(target: any) {\r\n    if (isReactive(target)) return target[RAW]\r\n}\r\n\r\nfunction createReactiveObject(target: any) {\r\n    const raw = target\r\n    const proxy: any = new Proxy(target, {\r\n        get(target, key, receiver) {\r\n            /* 判断是否是响应式对象 */\r\n            if (key === IS_REACTIVE) return true\r\n            /* 获取原对象 */\r\n            if (key === RAW) return raw\r\n\r\n            const result = Reflect.get(target, key, receiver)\r\n            /* 收集依赖 */\r\n            track(target, key)\r\n            /* 返回值 */\r\n            return isObject(result) ? reactive(result) : result\r\n        },\r\n        set(target, key, value, receiver) {\r\n            /* 获取旧值 */\r\n            const oldValue = target[key]\r\n            const oldLength = target.length\r\n\r\n            const result = Reflect.set(target, key, value, receiver)\r\n            /* 判断新值和旧值是否不一样 */\r\n            if (hasChanged(oldValue, value)) {\r\n                /* 触发依赖 */\r\n                trigger(target, key, value)\r\n                /* 如果是数组 判断是否依赖长度 是 判断是否改变 改变触发依赖 */\r\n                if (isArray(target) && target.length !== oldLength) trigger(target, 'length')\r\n            }\r\n            return result\r\n        }\r\n    })\r\n    /* 添加记录 */\r\n    reactiveMap.set(target, proxy)\r\n    return proxy\r\n}\r\n\r\nexport { reactive, toRaw }","import { isObject, isRef, hasChanged } from './utils'\r\nimport { reactive } from './reactive'\r\nimport { track, trigger } from './effect'\r\n\r\nfunction ref(value: any) {\r\n    /* 是否已经是响应式对象 如果是直接返回 */\r\n    if (isRef(value)) return value\r\n    /* 创建响应式对象 */\r\n    return new refImpl(value)\r\n}\r\n\r\nclass refImpl {\r\n    private __rawValue: any\r\n    private __isRef: boolean\r\n    private _value: any\r\n    /* \r\n        都是基础类型  __rawValue 和 _value 相等\r\n        如果是对象 \r\n            __rawValue：原始对象\r\n            _value：响应式对象\r\n    */\r\n    constructor(value: any) {\r\n        this.__isRef = true\r\n        this.__rawValue = value\r\n        this._value = convert(value)\r\n    }\r\n\r\n    get value() {\r\n        /* 收集依赖 */\r\n        track(this, 'value')\r\n        /* 返回值 */\r\n        return this._value\r\n    }\r\n\r\n    set value(value) {\r\n        if (hasChanged(this._value, value)) {\r\n            /* 更新数据 */\r\n            this._value = convert(value)\r\n            this.__rawValue = value\r\n            /* 触发依赖 */\r\n            trigger(this, 'value', value)\r\n        }\r\n    }\r\n}\r\n\r\nfunction convert(value: any) {\r\n    return isObject(value) ? reactive(value) : value\r\n}\r\n\r\n/* 自动判断是否是 ref 并且获取值 不是 旧返回参数 */\r\nfunction unRef(ref: any) {\r\n    return isRef(ref) ? ref.value : ref;\r\n}\r\n\r\nexport { ref, unRef }","import { effect } from './effect'\r\n\r\n/* 返回一个函数 调用 停止监听 */\r\nfunction watchEffect(func: Function): Function {\r\n    let effectFn: any = effect(func)\r\n    const deps = effectFn.deps\r\n    return function () {\r\n        deps.delete(effectFn)\r\n        effectFn = null\r\n    }\r\n}\r\n\r\nexport { watchEffect }","import { isRef } from './utils'\r\nimport { effect } from './effect'\r\n\r\nfunction watch(getter: any, func: Function): Function {\r\n    let _value = isRef(getter) ? getter.value : getter()\r\n\r\n    let effectFn: any = effect(() => isRef(getter) ? getter.value : getter(), {\r\n        scheduler: (effect: any, value: any) => {\r\n            func(value, _value)\r\n            _value = value\r\n        }\r\n    })\r\n    const deps = effectFn.deps\r\n    return function () {\r\n        deps.delete(effectFn)\r\n        effectFn = null\r\n        _value = null\r\n    }\r\n}\r\n\r\nexport { watch }","import { track, trigger, effect } from './effect'\r\nimport { isFunction } from './utils'\r\n\r\nfunction computed(getterOrOptions: any): ComputedRefImpl {\r\n    let getter, setter;\r\n    if (isFunction(getterOrOptions)) {\r\n        getter = getterOrOptions\r\n        setter = () => {\r\n            console.warn('Write operation failed: computed value is readonly')\r\n        }\r\n    } else {\r\n        getter = getterOrOptions.get;\r\n        setter = getterOrOptions.set;\r\n    }\r\n    return new ComputedRefImpl(getter, setter)\r\n}\r\n\r\nclass ComputedRefImpl {\r\n    private _setter: Function\r\n    private _value: any\r\n    private _dirty: boolean\r\n    private effect: any\r\n    constructor(getter: Function, setter: Function) {\r\n        this._setter = setter\r\n        /* 缓存结果 */\r\n        this._value = undefined\r\n        /* 判断依赖值是否改变 */\r\n        this._dirty = true\r\n        /* 监听依赖变化 */\r\n        this.effect = effect(getter, {\r\n            lazy: true,\r\n            scheduler: () => {\r\n                if (!this._dirty) {\r\n                    this._dirty = true\r\n                    /* 触发依赖 */\r\n                    trigger(this, 'value', this._value)\r\n                }\r\n            }\r\n        })\r\n    }\r\n\r\n    get value() {\r\n        if (this._dirty) {\r\n            this._value = this.effect()\r\n            this._dirty = false\r\n            /* 收集依赖 */\r\n            track(this, 'value')\r\n        }\r\n        return this._value\r\n    }\r\n\r\n    set value(value) {\r\n        this._setter(value)\r\n    }\r\n}\r\n\r\nexport { computed }","/* vNode 类型 */\r\nexport type vNode = {\r\n    /* 类型 */\r\n    type: string | Symbol | object,\r\n    /* 属性 */\r\n    props: object | null,\r\n    /* 孩子 */\r\n    children: string | number | [] | null,\r\n    /* 类型标签 */\r\n    shapeFlag: number,\r\n    /* DOM 节点 */\r\n    elm: HTMLElement | Text | null,\r\n    /* Fragment 专属属性 anchor */\r\n    anchor: Text | null\r\n}\r\n\r\n/* vNode 类型判断 使用位运算 可以提高效率 */\r\nexport const ShapeFlags = {\r\n    ELEMENT: 1, // 00000001 元素\r\n    TEXT: 1 << 1, // 00000010 文本\r\n    FRAGMENT: 1 << 2, // 00000100 容器\r\n    COMPONENT: 1 << 3, // 00001000 组件\r\n    TEXT_CHILDREN: 1 << 4, // 00010000 string 孩子\r\n    ARRAY_CHILDREN: 1 << 5, // 00100000 数组 孩子\r\n    CHILDREN: (1 << 4) | (1 << 5), //00110000 孩子\r\n}\r\n\r\n/* 文本唯一标识 */\r\nexport const Text = Symbol('Text')\r\n\r\n/* 容器唯一标识 */\r\nexport const Fragment = Symbol('Fragment')\r\n\r\n/* 判断是否是字符串 */\r\nexport function isString(target: any) {\r\n    return typeof target === 'string'\r\n}\r\n\r\n/* 判断是否是字符串 */\r\nexport function isNumber(target: any) {\r\n    return typeof target === 'number'\r\n}\r\n\r\n/* 判断是否是字符串 */\r\nexport function isArray(target: any) {\r\n    return Array.isArray(target)\r\n}\r\n\r\n/* 判断是否是同类型的vNode */\r\nexport function isSameVNode(n1: vNode, n2: vNode) {\r\n    return n1.type === n2.type\r\n}\r\n\r\n/* 判断孩子是否都有key */\r\nexport function isChildrenKey(c1: [], c2: []) {\r\n    let c1True = 0, c2True = 0\r\n    c1.forEach(c => {\r\n        if (c && c['key'] != null) c1True++\r\n    })\r\n    c2.forEach(c => {\r\n        if (c && c['key'] != null) c2True++\r\n    })\r\n    return c1True === c1.length && c2True === c2.length\r\n}\r\n\r\n/* 判断 vNode 类型 */\r\nexport function vNodeType(type: string | Symbol | object): number {\r\n    /* 判断是否是标签 */\r\n    if (isString(type)) return ShapeFlags.ELEMENT\r\n    /* 判断是否是文本 */\r\n    if (type === Text) return ShapeFlags.TEXT\r\n    /* 是否是容器 */\r\n    if (type === Fragment) return ShapeFlags.FRAGMENT\r\n    /* 是否是组件 */\r\n    return ShapeFlags.COMPONENT\r\n}\r\n\r\n/* dom 属性正则 */\r\nexport const domPropsRE = /[A-Z]|^(value|checked|selected|muted|disabled)$/","import { vNode, isString, isNumber, isArray, ShapeFlags, vNodeType } from './utils'\r\n\r\nfunction h(type: string | Symbol | object, props: object | null, children: string | number | [] | null): vNode {\r\n    let shapeFlag: number = vNodeType(type)\r\n\r\n    /* 判断 孩子 是否是 字符串 或者 数字 */\r\n    if (isString(children) || isNumber(children)) {\r\n        /* 用位或运算整合 */\r\n        shapeFlag |= ShapeFlags.TEXT_CHILDREN\r\n        children = children!.toString()\r\n    }\r\n\r\n    /* 判断 孩子 是否是 数组 */\r\n    if (isArray(children)) {\r\n        /* 用位或运算整合 */\r\n        shapeFlag |= ShapeFlags.ARRAY_CHILDREN\r\n    }\r\n\r\n    return { type, props, children, shapeFlag, elm: null, anchor: null }\r\n}\r\n\r\nexport { h }","import { vNode, ShapeFlags } from './utils'\r\nimport { patch, patchProps } from './patch'\r\n\r\n/* 挂载元素 */\r\nfunction mountElement(vNode: vNode, container: HTMLElement, anchor?: Text) {\r\n    const { type, props, shapeFlag, children } = vNode\r\n    const el = document.createElement(type as string)\r\n    if (props) patchProps(null, props, el)\r\n    if (shapeFlag & ShapeFlags.TEXT_CHILDREN) el.textContent = vNode.children as string\r\n    if (shapeFlag & ShapeFlags.ARRAY_CHILDREN) mountChildren(children as [], el)\r\n    vNode.elm = el\r\n    container.insertBefore(el, anchor as Text)\r\n}\r\n\r\n/* 挂载文本 */\r\nfunction mountTextNode(vNode: vNode, container: HTMLElement, anchor?: Text) {\r\n    const textNode = document.createTextNode(vNode.children as string)\r\n    vNode.elm = textNode\r\n    container.insertBefore(textNode, anchor as Text)\r\n}\r\n\r\n/* 挂载孩子 */\r\nfunction mountChildren(children: [], container: HTMLElement, anchor?: Text) {\r\n    children.forEach(child => {\r\n        patch(null, child, container, anchor!)\r\n    })\r\n}\r\n\r\nexport { mountElement, mountTextNode, mountChildren }","import { vNode } from './utils'\r\nimport { patchElement, patchChildren } from './patch'\r\nimport { mountElement, mountTextNode, mountChildren } from './mount'\r\n\r\n// TODO 处理组件\r\n/* 处理组件 */\r\nfunction processComponent(n1: vNode | null, n2: vNode, container: HTMLElement, anchor?: Text) { }\r\n\r\n/* 处理容器 */\r\nfunction processFragment(n1: vNode | null, n2: vNode, container: HTMLElement, anchor?: Text) {\r\n    const fragmentStartAnchor = n2.elm = n1 ? n1!.elm : document.createTextNode('')\r\n    const fragmentEndAnchor = n2.anchor = n1 ? n1!.anchor : document.createTextNode('')\r\n\r\n    if (n1) {\r\n        patchChildren(n1, n2, container, fragmentEndAnchor as Text)\r\n    } else {\r\n        container.insertBefore(fragmentStartAnchor as Text, anchor as Text)\r\n        container.insertBefore(fragmentEndAnchor as Text, anchor as Text)\r\n        mountChildren(n2.children as [], container, fragmentEndAnchor as Text)\r\n    }\r\n}\r\n\r\n/* 处理文本 */\r\nfunction processText(n1: vNode | null, n2: vNode, container: HTMLElement, anchor?: Text) {\r\n    if (n1) {\r\n        if (n1.elm?.textContent !== n2.children) (n1 as any).elm.textContent = n2.children\r\n        n2.elm = n1.elm\r\n    } else {\r\n        mountTextNode(n2, container, anchor)\r\n    }\r\n}\r\n\r\n/* 处理元素 */\r\nfunction processElement(n1: vNode | null, n2: vNode, container: HTMLElement, anchor?: Text) {\r\n    if (n1) {\r\n        patchElement(n1, n2)\r\n    } else {\r\n        mountElement(n2, container, anchor)\r\n    }\r\n}\r\n\r\nexport { processComponent, processFragment, processText, processElement } ","import { vNode, ShapeFlags } from './utils'\r\n\r\n/* 卸载 vNode */\r\nfunction unmount(vNode: vNode) {\r\n    const { shapeFlag } = vNode\r\n    if (shapeFlag & ShapeFlags.COMPONENT) {\r\n        unmountComponent(vNode)\r\n    } else if (shapeFlag & ShapeFlags.FRAGMENT) {\r\n        unmountFragment(vNode)\r\n    } else {\r\n        unmountElementOrText(vNode)\r\n    }\r\n}\r\n\r\n// TODO 卸载组件\r\n/* 卸载组件 */\r\nfunction unmountComponent(vNode: vNode) { }\r\n\r\n/* 卸载容器 */\r\nfunction unmountFragment(vNode: vNode) {\r\n    let { elm: cur, anchor: end } = vNode\r\n    const parentNode = cur!.parentNode\r\n    while (cur !== end) {\r\n        const next = cur!.nextSibling\r\n        parentNode!.removeChild(cur!);\r\n        (cur as any) = next\r\n    }\r\n    parentNode!.removeChild(end!)\r\n}\r\n\r\n/* 卸载元素或文本 */\r\nfunction unmountElementOrText(vNode: vNode) {\r\n    const { elm } = vNode\r\n    elm!.parentNode!.removeChild(elm as HTMLElement | Text)\r\n}\r\n\r\n/* 卸载孩子 */\r\nfunction unmountChildren(children: []) {\r\n    children.forEach(child => {\r\n        unmount(child)\r\n    })\r\n}\r\n\r\nexport { unmount, unmountChildren }","import { vNode, isSameVNode, ShapeFlags, domPropsRE, isChildrenKey } from \"./utils\"\r\nimport { processComponent, processFragment, processText, processElement } from './process'\r\nimport { unmount, unmountChildren } from './unmount'\r\nimport { mountChildren } from './mount'\r\n\r\nfunction patch(n1: vNode | null, n2: vNode, container: HTMLElement, anchor?: Text) {\r\n    if (n1 && !isSameVNode(n1, n2)) {\r\n        /* n1被卸载后，n2将会创建，因此anchor至关重要。需要将它设置为n1的下一个兄弟节点 */\r\n\r\n        (anchor as any) = (n1.anchor || n1.elm)!.nextSibling\r\n        unmount(n1)\r\n        n1 = null\r\n    }\r\n\r\n    const { shapeFlag } = n2\r\n    /* 判断 n2 是否是组件 */\r\n    if (shapeFlag & ShapeFlags.COMPONENT) processComponent(n1, n2, container, anchor)\r\n    /* 判断 n2 是否是文本 */\r\n    if (shapeFlag & ShapeFlags.TEXT) processText(n1, n2, container, anchor)\r\n    /* 判断 n2 是否是元素 */\r\n    if (shapeFlag & ShapeFlags.FRAGMENT) processFragment(n1, n2, container, anchor)\r\n    /* 判断 n2 是否是容器 */\r\n    if (shapeFlag & ShapeFlags.ELEMENT) processElement(n1, n2, container, anchor)\r\n}\r\n\r\n/* 更新元素 */\r\nfunction patchElement(n1: vNode | null, n2: vNode) {\r\n    n2.elm = n1!.elm\r\n    patchProps(n1!.props as object, n2.props as object, n2.elm as HTMLElement)\r\n    patchChildren(n1, n2, n2.elm as HTMLElement)\r\n}\r\n\r\n/* 更新属性 */\r\nfunction patchProps(oldProps: object | null, newProps: object | null, container: HTMLElement) {\r\n    if (oldProps === newProps) return\r\n    oldProps = oldProps || {}\r\n    newProps = newProps || {}\r\n    for (const key in newProps) {\r\n        if (key === 'key') continue\r\n        const prev = (oldProps as any)[key]\r\n        const next = (newProps as any)[key]\r\n        if (prev !== next) {\r\n            patchDomProp(container, key, prev, next)\r\n        }\r\n    }\r\n    for (const key in oldProps) {\r\n        if (key !== 'key' && !(key in newProps)) {\r\n            patchDomProp(container, key, (oldProps as any)[key], null)\r\n        }\r\n    }\r\n}\r\n\r\n/* 更新 DOM 属性 */\r\nfunction patchDomProp(el: HTMLElement, key: string, prev: string | object, next: string | object | null) {\r\n    switch (key) {\r\n        case 'class':\r\n            // 暂时认为class就是字符串\r\n            // next可能为null，会变成'null'，因此要设成''\r\n            el.className = next as string || ''\r\n            break\r\n        case 'style':\r\n            // style为对象\r\n            if (!next) {\r\n                el.removeAttribute('style')\r\n            } else {\r\n                for (const styleName in next as object) {\r\n                    (el.style as any)[styleName] = (next as any)[styleName]\r\n                }\r\n                if (prev) {\r\n                    for (const styleName in prev as object) {\r\n                        if ((next as any)[styleName] == null) {\r\n                            (el.style as any)[styleName] = ''\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            break\r\n        default:\r\n            if (/^on[^a-z]/.test(key)) {\r\n                // 事件\r\n                if (prev !== next) {\r\n                    const eventName = key.slice(2).toLowerCase()\r\n                    if (prev) {\r\n                        (el.removeEventListener as any)(eventName, prev)\r\n                    }\r\n                    if (next) {\r\n                        (el.addEventListener as any)(eventName, next)\r\n                    }\r\n                }\r\n            } else if (domPropsRE.test(key)) {\r\n                if (next === '' && typeof (el as any)[key] === 'boolean') {\r\n                    (next as any) = true\r\n                }\r\n                (el as any)[key] = next\r\n            } else {\r\n                // 例如自定义属性{custom: ''}，应该用setAttribute设置为<input custom />\r\n                // 而{custom: null}，应用removeAttribute设置为<input />\r\n                if (next == null || next as any === false) {\r\n                    el.removeAttribute(key)\r\n                } else {\r\n                    el.setAttribute(key, (next as any))\r\n                }\r\n            }\r\n            break\r\n    }\r\n}\r\n\r\n/* 更新孩子 */\r\nfunction patchChildren(n1: vNode | null, n2: vNode, container: HTMLElement, anchor?: Text) {\r\n    const { shapeFlag: prevShapeFlag, children: c1 } = n1!\r\n    const { shapeFlag, children: c2 } = n2\r\n\r\n    /* 新 vNode 孩子是 文本 */\r\n    if (shapeFlag & ShapeFlags.TEXT_CHILDREN) {\r\n        /* 旧 vNode 孩子是 数组  卸载孩子*/\r\n        if (prevShapeFlag & ShapeFlags.ARRAY_CHILDREN) unmountChildren(c1 as [])\r\n        /* 如果 新旧孩子文本内容不一致 文本内容设置为 新孩子    PS：旧 vNode 孩子是 数组 testContent 是 null */\r\n        if (c2 !== c1) container.textContent = c2 as string | null\r\n\r\n        /* 新 vNode 孩子是 数组 */\r\n    } else if (shapeFlag & ShapeFlags.ARRAY_CHILDREN) {\r\n        /* 旧 vNode 孩子是 数组*/\r\n        if (prevShapeFlag & ShapeFlags.ARRAY_CHILDREN) {\r\n            /* 判断是否有key 调用不同的 diff 算法 */\r\n            if (isChildrenKey(c1 as [], c2 as [])) {\r\n                patchKeyedChildren()\r\n            } else {\r\n                patchUnKeyedChildren(c1 as [], c2 as [], container, anchor)\r\n            }\r\n        } else {\r\n            /* 旧 vNode 孩子是 文本 或 null */\r\n            container.textContent = null\r\n            mountChildren(c2 as [], container, anchor)\r\n        }\r\n\r\n        /* 新 vNode 孩子是 null */\r\n    } else {\r\n        /* 旧 vNode 孩子是 文本 */\r\n        if (prevShapeFlag & ShapeFlags.TEXT_CHILDREN) container.textContent = null\r\n        /* 旧 vNode 孩子是 数组 */\r\n        if (prevShapeFlag & ShapeFlags.ARRAY_CHILDREN) unmountChildren(c1 as [])\r\n    }\r\n}\r\n\r\nfunction patchKeyedChildren() { }\r\n\r\nfunction patchUnKeyedChildren(c1: [], c2: [], container: HTMLElement, anchor?: Text) {\r\n    const oldLength = c1.length\r\n    const newLength = c2.length\r\n    const commonLength = Math.min(oldLength, newLength)\r\n    for (let i = 0; i < commonLength; i++) {\r\n        patch(c1[i], c2[i], container, anchor)\r\n    }\r\n    if (newLength > oldLength) {\r\n        mountChildren(c2.slice(commonLength) as [], container, anchor)\r\n    } else if (newLength < oldLength) {\r\n        unmountChildren(c1.slice(commonLength) as [])\r\n    }\r\n}\r\n\r\nexport { patch, patchElement, patchProps, patchChildren }","import { vNode } from './utils'\r\nimport { patch } from './patch'\r\nimport { unmount } from './unmount'\r\n\r\n/* 渲染函数 */\r\nfunction render(vNode: vNode | null, container: HTMLElement) {\r\n    const pervVNode = (container as any)._vNode\r\n    /*  判断是否传入新的vNode */\r\n    if (vNode) {\r\n        /* 进行 diff 算法 */\r\n        patch(pervVNode, vNode, container)\r\n    } else {\r\n        /* 没有传入新的 vNode 且有旧的 vNode 卸载旧 vNode */\r\n        if (pervVNode) unmount(pervVNode)\r\n    }\r\n    (container as any)._vNode = vNode\r\n}\r\n\r\nexport { render }"],"names":["IS_REACTIVE","IS_REF","RAW","isObject","target","isArray","Array","isFunction","isReactive","isRef","value","hasChanged","oldValue","newValue","Number","isNaN","effectStack","activeEffect","effect","func","options","effectFn","push","pop","length","lazy","scheduler","targetMap","WeakMap","track","key","depsMap","get","set","Map","deps","Set","add","trigger","forEach","reactiveMap","reactive","has","createReactiveObject","toRaw","raw","proxy","Proxy","receiver","result","Reflect","oldLength","ref","refImpl","constructor","__isRef","__rawValue","_value","convert","unRef","watchEffect","delete","watch","getter","computed","getterOrOptions","setter","console","warn","ComputedRefImpl","_setter","undefined","_dirty","ShapeFlags","ELEMENT","TEXT","FRAGMENT","COMPONENT","TEXT_CHILDREN","ARRAY_CHILDREN","CHILDREN","Text","Symbol","Fragment","isString","isNumber","isSameVNode","n1","n2","type","isChildrenKey","c1","c2","c1True","c2True","c","vNodeType","domPropsRE","h","props","children","shapeFlag","toString","elm","anchor","mountElement","vNode","container","el","document","createElement","patchProps","textContent","mountChildren","insertBefore","mountTextNode","textNode","createTextNode","child","patch","processFragment","fragmentStartAnchor","fragmentEndAnchor","patchChildren","processText","processElement","patchElement","unmount","unmountFragment","unmountElementOrText","cur","end","parentNode","next","nextSibling","removeChild","unmountChildren","oldProps","newProps","prev","patchDomProp","className","removeAttribute","styleName","style","test","eventName","slice","toLowerCase","removeEventListener","addEventListener","setAttribute","prevShapeFlag","patchUnKeyedChildren","newLength","commonLength","Math","min","i","render","pervVNode","_vNode"],"mappings":"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"}