{"version":3,"file":"rainCore.min.js","sources":["../node_modules/@babel/runtime/helpers/esm/typeof.js","../src/reactivity/utils.ts","../src/reactivity/effect.ts","../src/reactivity/reactive.ts","../node_modules/@babel/runtime/helpers/esm/createClass.js","../src/reactivity/ref.ts","../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"],"sourcesContent":["export default function _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) {\n    return typeof obj;\n  } : function (obj) {\n    return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n  }, _typeof(obj);\n}","/* reactive 响应式标识 */\r\nexport const IS_REACTIVE: string = '__isReactive'\r\n/* reactive 响应式标识 */\r\nexport const IS_REF: string = '__isRef'\r\n/* 代理前对象标识 */\r\nexport const RAW: string = '__raw'\r\n\r\n/* 判断是否是对象 */\r\nexport function isObject(target: any) {\r\n    return typeof target === 'object' && target != null\r\n}\r\n/* 判断是否是数组 */\r\nexport function isArray(target: any) {\r\n    return Array.isArray(target)\r\n}\r\n\r\n/* 判断是否是 reactive 响应式对象 */\r\nexport function isReactive(target: any) {\r\n    return !!(target && target[IS_REACTIVE])\r\n\r\n}\r\n\r\n/* 判断是否是 ref 响应式对象 */\r\nexport function isRef(value: any) {\r\n    return !!(value && value[IS_REF])\r\n}\r\n\r\n/* 判断两个值是否一致 */\r\nexport function hasChanged(oldValue: any, newValue: any) {\r\n    return oldValue !== newValue && !(Number.isNaN(oldValue) || Number.isNaN(newValue))\r\n}","const effectStack: any = []\r\n/* 暴露依赖 */\r\nlet activeEffect: Function | null\r\n\r\nfunction watchEffect(func: Function, options: any = {}): Function {\r\n    const effect = () => {\r\n        try {\r\n            effectStack.push(effect)\r\n            activeEffect = effect\r\n            return func()\r\n        } finally {\r\n            effectStack.pop()\r\n            activeEffect = effectStack[effectStack.length - 1]\r\n        }\r\n    }\r\n\r\n    if (!options.lazy) effect()\r\n\r\n    effect.scheduler = options.scheduler\r\n\r\n    return effect\r\n}\r\n\r\n/* 收集依赖 */\r\nconst targetMap: WeakMap<object, any> = new WeakMap()\r\n\r\nfunction track(target: any, key: string | symbol): void {\r\n    /* 是否有依赖需要收集 没有直接发返回 */\r\n    if (!activeEffect) return\r\n    /* \r\n        查找是否有此响应式数据对应的依赖组 \r\n        如果没有为该数据创建 Map \r\n    */\r\n    let depsMap = targetMap.get(target)\r\n    if (!depsMap) targetMap.set(target, (depsMap = new Map()))\r\n    /* \r\n        查找是否有此响应式数据内数据的依赖组 \r\n        如果没有为该数据创建 Set \r\n    */\r\n    let deps = depsMap.get(key)\r\n    if (!deps) depsMap.set(key, (deps = new Set()))\r\n    /* 添加依赖 */\r\n    deps.add(activeEffect)\r\n}\r\n\r\n/* 触发依赖 */\r\nfunction trigger(target: any, key: string | symbol): void {\r\n    const depsMap = targetMap.get(target)\r\n    /* \r\n        查找是否有此响应式数据对应的依赖组 \r\n        没有就直接返回\r\n    */\r\n    if (!depsMap) return\r\n    /* \r\n       查找是否有此响应式数据内数据的依赖组 \r\n       没有就直接返回\r\n    */\r\n    const deps = depsMap.get(key)\r\n    if (!deps) return\r\n    /* 触发依赖 */\r\n    deps.forEach((effect: () => any) => {\r\n        effect()\r\n    })\r\n}\r\n\r\nexport { watchEffect, track, trigger }","import { IS_REACTIVE, RAW, isObject, isArray, isReactive, hasChanged } from './utils'\r\nimport { track, trigger } from './effect'\r\n\r\n/* 保存响应式对象 */\r\nconst reactiveMap = new WeakMap()\r\n\r\nfunction reactive(target: any) {\r\n    /* 如果不是对象直接返回 */\r\n    if (!isObject(target)) return target\r\n    /* 是否已经是响应式对象 如果是直接返回 */\r\n    if (isReactive(target)) return target\r\n    /* 如果对象已经做过响应式 就直接返沪响应式对象 */\r\n    if (reactiveMap.has(target)) return reactiveMap.get(target)\r\n    /* 创建响应式对象 */\r\n    return createReactiveObject(target)\r\n}\r\n\r\n/* 提供一个响应式对象，返回原始对象 */\r\nfunction toRaw(target: any) {\r\n    if (isReactive(target)) return target[RAW]\r\n}\r\n\r\nfunction createReactiveObject(target: any) {\r\n    const raw = target\r\n    const proxy: any = new Proxy(target, {\r\n        get(target, key, receiver) {\r\n            /* 判断是否是响应式对象 */\r\n            if (key === IS_REACTIVE) return true\r\n            /* 获取原对象 */\r\n            if (key === RAW) return raw\r\n\r\n            const result = Reflect.get(target, key, receiver)\r\n            /* 收集依赖 */\r\n            track(target, key)\r\n            /* 返回值 */\r\n            return isObject(result) ? reactive(result) : result\r\n        },\r\n        set(target, key, value, receiver) {\r\n            /* 获取旧值 */\r\n            const oldValue = target[key]\r\n            const oldLength = target.length\r\n\r\n            const result = Reflect.set(target, key, value, receiver)\r\n            /* 判断新值和旧值是否不一样 */\r\n            if (hasChanged(oldValue, value)) {\r\n                /* 触发依赖 */\r\n                trigger(target, key)\r\n                /* 如果是数组 判断是否依赖长度 是 判断是否改变 改变触发依赖 */\r\n                if (isArray(target) && target.length !== oldLength) trigger(target, 'length')\r\n            }\r\n            return result\r\n        }\r\n    })\r\n    /* 添加记录 */\r\n    reactiveMap.set(target, proxy)\r\n    return proxy\r\n}\r\n\r\nexport { reactive, toRaw }","function _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nexport default function _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  Object.defineProperty(Constructor, \"prototype\", {\n    writable: false\n  });\n  return Constructor;\n}","import { isObject, isRef, hasChanged } from './utils'\r\nimport { reactive } from './reactive'\r\nimport { track, trigger } from './effect'\r\n\r\nfunction ref(value: any) {\r\n    /* 是否已经是响应式对象 如果是直接返回 */\r\n    if (isRef(value)) return value\r\n    /* 创建响应式对象 */\r\n    return new refImpl(value)\r\n}\r\n\r\nclass refImpl {\r\n    private __rawValue: any\r\n    private __isRef: boolean\r\n    private _value: any\r\n    /* \r\n        都是基础类型  __rawValue 和 _value 相等\r\n        如果是对象 \r\n            __rawValue：原始对象\r\n            _value：响应式对象\r\n    */\r\n    constructor(value: any) {\r\n        this.__isRef = true\r\n        this.__rawValue = value\r\n        this._value = convert(value)\r\n    }\r\n\r\n    get value() {\r\n        /* 收集依赖 */\r\n        track(this, 'value')\r\n        /* 返回值 */\r\n        return this._value\r\n    }\r\n\r\n    set value(value) {\r\n        if (hasChanged(this._value, value)) {\r\n            /* 更新数据 */\r\n            this._value = convert(value)\r\n            this.__rawValue = value\r\n            /* 触发依赖 */\r\n            trigger(this, 'value')\r\n        }\r\n    }\r\n}\r\n\r\nfunction convert(value: any) {\r\n    return isObject(value) ? reactive(value) : value\r\n}\r\n\r\nfunction unRef(ref: any) {\r\n    return isRef(ref) ? ref.value : ref;\r\n}\r\n\r\nexport { ref, unRef }","export default function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}"],"names":["_typeof","obj","Symbol","iterator","constructor","prototype","IS_REACTIVE","RAW","isObject","target","isReactive","isRef","value","hasChanged","oldValue","newValue","Number","isNaN","activeEffect","effectStack","targetMap","WeakMap","track","key","depsMap","get","set","Map","deps","Set","add","trigger","forEach","effect","reactiveMap","reactive","has","raw","proxy","Proxy","receiver","result","Reflect","oldLength","length","Array","isArray","createReactiveObject","_defineProperties","props","i","descriptor","enumerable","configurable","writable","Object","defineProperty","refImpl","instance","Constructor","TypeError","__isRef","__rawValue","_value","convert","protoProps","staticProps","this","ref","func","options","push","pop","lazy","scheduler"],"mappings":"s6CAAe,SAASA,EAAQC,GAG9B,OAAOD,EAAU,mBAAqBE,QAAU,iBAAmBA,OAAOC,SAAW,SAAUF,GAC7F,cAAcA,GACZ,SAAUA,GACZ,OAAOA,GAAO,mBAAqBC,QAAUD,EAAIG,cAAgBF,QAAUD,IAAQC,OAAOG,UAAY,gBAAkBJ,GACvHD,EAAQC,GCNN,IAAMK,EAAsB,eAItBC,EAAc,QAGpB,SAASC,EAASC,SACI,WAAlBT,EAAOS,IAAiC,MAAVA,EAQlC,SAASC,EAAWD,YACbA,IAAUA,EAAM,cAKvB,SAASE,EAAMC,YACRA,IAASA,EAAK,SAIrB,SAASC,EAAWC,EAAeC,UAC/BD,IAAaC,KAAcC,OAAOC,MAAMH,IAAaE,OAAOC,MAAMF,IC7B7E,IAEIG,EAFEC,EAAmB,GAwBzB,IAAMC,EAAkC,IAAIC,QAE5C,SAASC,EAAMb,EAAac,MAEnBL,OAKDM,EAAUJ,EAAUK,IAAIhB,GACvBe,GAASJ,EAAUM,IAAIjB,EAASe,EAAU,IAAIG,SAK/CC,EAAOJ,EAAQC,IAAIF,GAClBK,GAAMJ,EAAQE,IAAIH,EAAMK,EAAO,IAAIC,KAExCD,EAAKE,IAAIZ,IAIb,SAASa,EAAQtB,EAAac,OACpBC,EAAUJ,EAAUK,IAAIhB,MAKzBe,OAKCI,EAAOJ,EAAQC,IAAIF,GACpBK,GAELA,EAAKI,SAAQ,SAACC,GACVA,QCzDR,IAAMC,EAAc,IAAIb,QAExB,SAASc,EAAS1B,UAETD,EAASC,GAEVC,EAAWD,GAAgBA,EAE3ByB,EAAYE,IAAI3B,GAAgByB,EAAYT,IAAIhB,GAUxD,SAA8BA,OACpB4B,EAAM5B,EACN6B,EAAa,IAAIC,MAAM9B,EAAQ,CACjCgB,aAAIhB,EAAQc,EAAKiB,MAETjB,IAAQjB,EAAa,OAAO,KAE5BiB,IAAQhB,EAAK,OAAO8B,MAElBI,EAASC,QAAQjB,IAAIhB,EAAQc,EAAKiB,UAExClB,EAAMb,EAAQc,GAEPf,EAASiC,GAAUN,EAASM,GAAUA,GAEjDf,aAAIjB,EAAQc,EAAKX,EAAO4B,OAEd1B,EAAWL,EAAOc,GAClBoB,EAAYlC,EAAOmC,OAEnBH,EAASC,QAAQhB,IAAIjB,EAAQc,EAAKX,EAAO4B,UAE3C3B,EAAWC,EAAUF,KAErBmB,EAAQtB,EAAQc,GFlCzB,SAAiBd,UACboC,MAAMC,QAAQrC,GEmCLqC,CAAQrC,IAAWA,EAAOmC,SAAWD,GAAWZ,EAAQtB,EAAQ,WAEjEgC,YAIfP,EAAYR,IAAIjB,EAAQ6B,GACjBA,EAzCAS,CAAqBtC,GANEA,ECRlC,SAASuC,EAAkBvC,EAAQwC,GACjC,IAAK,IAAIC,EAAI,EAAGA,EAAID,EAAML,OAAQM,IAAK,CACrC,IAAIC,EAAaF,EAAMC,GACvBC,EAAWC,WAAaD,EAAWC,aAAc,EACjDD,EAAWE,cAAe,EACtB,UAAWF,IAAYA,EAAWG,UAAW,GACjDC,OAAOC,eAAe/C,EAAQ0C,EAAW5B,IAAK4B,QCK5CM,wBAUU7C,ICrBD,SAAyB8C,EAAUC,GAChD,KAAMD,aAAoBC,GACxB,MAAM,IAAIC,UAAU,mDDoBXC,SAAU,OACVC,WAAalD,OACbmD,OAASC,EAAQpD,GDdf,IAAsB+C,EAAaM,EAAYC,SAAzBP,KAAaM,oBCiB9C,kBAEI3C,EAAM6C,KAAM,SAELA,KAAKJ,YAGhB,SAAUnD,GACFC,EAAWsD,KAAKJ,OAAQnD,UAEnBmD,OAASC,EAAQpD,QACjBkD,WAAalD,EAElBmB,EAAQoC,KAAM,eD7BRnB,EAAkBW,EAAYtD,UAAW4D,GACrDC,GAAalB,EAAkBW,EAAaO,GAChDX,OAAOC,eAAeG,EAAa,YAAa,CAC9CL,UAAU,SC+Bd,SAASU,EAAQpD,UACNJ,EAASI,GAASuB,EAASvB,GAASA,8CA1C/C,SAAaA,UAELD,EAAMC,GAAeA,EAElB,IAAI6C,EAAQ7C,YFUvB,SAAeH,MACPC,EAAWD,GAAS,OAAOA,EAAOF,YE8B1C,SAAe6D,UACJzD,EAAMyD,GAAOA,EAAIxD,MAAQwD,iBH9CpC,SAAqBC,OAAgBC,4DAAe,GAC1CrC,EAAS,SAATA,eAEEd,EAAYoD,KAAKtC,GACjBf,EAAee,EACRoC,YAEPlD,EAAYqD,MACZtD,EAAeC,EAAYA,EAAYyB,OAAS,YAInD0B,EAAQG,MAAMxC,IAEnBA,EAAOyC,UAAYJ,EAAQI,UAEpBzC"}