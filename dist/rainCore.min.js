!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).rainCore={})}(this,function(e){"use strict";function m(e){var t=document.createElement(e.sel);if(e.data!=={})for(var n in e.data)t.setAttribute(n,e.data[n]);if(null!=e.text&&(t.innerText=e.text),e.children!==[]){for(var r=document.createDocumentFragment(),i=0;i<e.children.length;i++)r.appendChild(m(e.children[i]));t.appendChild(r)}return e.elm=t}function r(e,t,n,r){return null!=n?"string"==typeof n&&(r=n,n=[]):n=[],null!=t?"string"==typeof t?(r=t,t={}):t.constructor===Array&&(n=t,t={}):t={},{sel:e,data:t,children:n,elm:void 0,text:r,key:null==t?void 0:t.key}}function _(e,t){return e.sel===t.sel&&e.key===t.key}function n(e,t){e.parentNode.insertBefore(t,e),e.parentNode.removeChild(e)}function g(e,t){if(e!==t){if(null==t.text||null!=t.children&&0!==t.children.length)if(null!=e.children&&0<e.children.length)!function(e,t,n){for(var r=0,i=0,o=t.length-1,a=n.length-1,l=t[r],u=t[o],s=n[i],f=n[a],c=null;r<=o&&i<=a;)if(null!=t[r]&&null!=l)if(null!=t[o]&&null!=u)if(null!=n[i]&&null!=s)if(null!=n[a]&&null!=f)if(_(l,s))g(l,s),l=t[++r],s=n[++i];else if(_(u,f))g(u,f),u=t[--o],f=n[--a];else if(_(l,f))g(l,f),e.insertBefore(l.elm,u.elm.nextSibling),l=t[++r],f=n[--a];else if(_(u,s))g(u,s),e.insertBefore(u,l.elm),u=t[--o],s=n[++i];else{if(!c)for(var c={},p=r;p<=o;p++){var d=t[p].key;null!=d&&(c[d]=p)}var h,v=c[i.key];null==v?e.insertBefore(m(s),l.elm):(g(h=t[v],s),t[v]=void 0,e.insertBefore(h.elm,l.elm)),s=n[++a]}else f=n[--a];else s=n[++i];else u=t[--o];else l=t[++r];if(i<=a)for(p=i;p<=a;p++)e.insertBefore(m(n[p]),null==t[r]?null:t[r].elm);if(r<=o)for(p=r;p<=o;p++)t[p]&&e.removeChild(t[p].elm)}(e.elm,e.children,t.children);else{e.elm.innerHTML="";for(var n=document.createDocumentFragment(),r=0;r<t.children.length;r++)n.appendChild(m(t.children[r]));e.elm.appendChild(n)}else e.text!==t.text&&(e.elm.innerText=t.text);if(t.data!=={})if(e.data!=={}){for(var i in t.data)e.data[i]&&(e.data[i]=void 0),e.elm.setAttribute(i,t.data[i]);for(var i in e.data)e.data[i]&&e.elm.removeAttribute(i)}else for(var i in t.data)e.elm.setAttribute(i,t.data[i]);else if(e.data!=={})for(var i in e.data)e.elm.removeAttribute(i);t.elm=e.elm}}function i(e,t){_(e,t)?g(e,t):n(e.elm,m(t))}var t=Object.freeze({__proto__:null,h:r,mountNode:function(e,t){n(e,m(t))},patch:i});function o(e,t){for(var n=e,r=t.split("."),i=0;i<r.length;i++)n=n[r[i]];return n}function a(e){for(var t="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",n="",r=0;r<e;r++)n+=t[Math.floor(Math.random()*t.length)];return n}function l(e,t){for(var n=[],r=0;r<e.length;r++)n.push(t(e[r],r,e));return n}var u,s=[];function f(e,t,n){this.data=e,this.key=t,this.callback=n,this.deps={},this.value=this.get()}function c(){this.id=a(8),this.subs=[]}function p(e,t,n){n=n||e[t];var r=new c,i=d(n);Object.defineProperty(e,t,{get:function(){return r.depend(),i&&(i.dep.depend(),n.constructor===Array&&function e(t){for(var n=0;n<t.length;n++)t[n]&&t[n].__ob__&&t[n].__ob__.dep.depend(),t[n].constructor===Array&&e(t[n])}(n)),n},set:function(e){e!==n&&(i=d(n=e),r.notify())}})}function d(e){if("object"==typeof e)return e.__ob__&&e.__ob__ instanceof h?e.__ob__:new h(e)}function h(e){this._data=e,this.def(),this._data.constructor===Array?(this.proxyPrototype(),this.array()):this.walk()}f.prototype.get=function(){e=this,s.push(u),u=e;var e=o(this.data,this.key);return u=s.pop(),e},f.prototype.addDep=function(e){e.id in this.deps||(this.deps[e.id]=e).addSub(u)},f.prototype.update=function(){var e=this.value;this.value=o(this.data,this.key),this.callback(this.value,e,this.data)},f.prototype.remove=function(){for(var e in this.deps)this.deps[e].removeSub(this)},c.prototype.addSub=function(e){this.subs.push(e)},c.prototype.depend=function(){u&&u.addDep(this)},c.prototype.notify=function(){for(var e=0;e<this.subs.length;e++)this.subs[e].update()},c.prototype.removeSub=function(e){e=function(e,t){for(var n=0;n<e.length;n++)if(t===e[n])return n;return-1}(this.subs,e);-1<e&&this.subs.splice(e,1)},h.prototype.walk=function(){for(var e in this._data)p(this._data,e)},h.prototype.array=function(){for(var e=0;e<this._data.length;e++)d(this._data[e])},h.prototype.proxyPrototype=function(){var n=Array.prototype,e=["push","pop","shift","unshift","splice","reverse","sort"],r={};r.__proto__=n;for(var t=0;t<e.length;t++)!function(t){Object.defineProperty(r,t,{value:function(){var e=n[t].apply(this,arguments);return"push"!==t&&"unshift"!==t||this.__ob__.array(arguments),"splice"===t&&this.__ob__.array(arguments.slice(2)),this.__ob__.dep.notify(),e},enumerable:!1,writable:!0,configurable:!0})}(e[t]);this._data.__proto__=r},h.prototype.def=function(){this.dep=new c,Object.defineProperty(this._data,"__ob__",{value:this,enumerable:!1,writable:!0,configurable:!0})};var v={};function y(e,t,n){t=new f(e,t,n),n=a(8);return v[n]=t,n}var b=Object.freeze({__proto__:null,watch:y,remove:function(e){if(e)v[e].remove(),delete v[e];else{for(key in v)v[key].remove();v={}}},observer:d}),x="{{",w="}}",k="r",j=!1;function A(e){return j||(x=l(x.split(""),function(e){return"\\"+e}).join(""),w=l(w.split(""),function(e){return"\\"+e}).join(""),j=!0),new RegExp(x+".+"+w).test(e)}var C=[],O=[],T=[];function B(e){var t=e.replace(/\<|\>/g,""),e={children:[],text:void 0};e.sel=t.match(/^\w+/)[0],e.data=function(e,t){var n={},r=!1,i=(e=e.replace(/\s*\//,"")).replace(/^\w+(\s+)?/,"").replace(/(\'|\")\s+/g,"=").replace(/(\'|\")/g,"");if(""===i||null==i)return n;i=i.split("=");for(var o=0;o<i.length;o+=2)!function(e){return new RegExp(k+"-").test(e)}(i[o])||(r=!0),n[i[o]]=i[o+1];r&&T.push(t);return n}(t,e);for(var n=[],r=0;r<C.length;r++)n.push(C[r].children.length);return e.path=n,e}var D,E,R,P,z,N=Object.freeze({__proto__:null,parser:function(e){for(e=function(e){e=e.trim();return e=e.replace(/\>(\s+)\</g,"><")}(e);e.length;){var t,n;/(^\<[^\/][^\<\>]*[^\/]\>)|(^\<.\>)/.test(e)?(n=B(e.match(/(^\<[^\/][^\<\>]*[^\/]\>)|(^\<.\>)/)[0]),C.push(n),e=e.replace(/(^\<[^\/][^\<\>]*[^\/]\>)|(^\<.\>)/,"")):/^\<[^\/][^\<\>]*\/\>/.test(e)?(n=B(e.match(/^\<[^\/][^\<\>]*\/\>/)[0]),(1<C.length?C[C.length-1].children:C).push(n),e=e.replace(/^\<[^\/][^\<\>]*\/\>/,"")):/^[^\<]+</.test(e)?null!=(t=e.match(/^[^\<]+</))&&(A(t)&&O.push(C[C.length-1]),t=t[0].slice(0,-1),C[C.length-1].text=t,e=e.replace(/^[^\<]+</,"<")):/^\<\/[^\<\>]+\>/.test(e)&&(1<C.length&&(n=C.pop(),C[C.length-1].children.push(n)),e=e.replace(/^\<\/[^\<\>]+\>/,""))}return{ast:C[0],mapperContentAst:O,mapperInstructionAst:T}},setContentReplacementTags:function(e,t){x=e,w=t},setInstructionHeader:function(e){k=e}});function S(e){for(var t=[],n=0;n<e.children.length;n++)t.push(S(e.children[n]));return r(e.sel,e.data,t,e.text)}function M(e,t){if(D[e]&&D[e].value!==t){for(var n=D[e].mapper,r=0;r<n.length;r++)E[n[r]].text=t;D[e].value=t}}function F(e,t,n,r){y(e,t,function(e){M(t,e);e=S(n);i(r,e),r=e})}var I=Object.freeze({__proto__:null,registrationInstruction:function(e,t,n){R=e,P=t,z=n},model:function(e){for(var t=0;t<e.length;t++){var n,r=e[t].data[k+"-model"];r&&(F(R,r,P,z),(n=function(e,t){for(var n=e,r=0;r<t.length;r++)n=n.children[t[r]];return n}(z,e[t].path).elm).addEventListener("input",function(){!function(e,t){for(var n=obj,r=t.split("."),i=0;i<r.length;i++)i===r.length-1?n[r[i]]=e.target.value:n=n[r[i]]}(event,r)}),n.value=o(R,r),n.removeAttribute(k+"-model"),delete e[t].data[k+"-model"])}}}),I=Object.freeze({__proto__:null,astToDom:function(e,t){e.parentNode.insertBefore(function e(t){var n=document.createElement(t.sel);if(t.data!=={})for(var r in t.data)n.setAttribute(r,t.data[r]);null!=t.text&&(n.innerText=t.text);if(t.children!==[]){for(var i=document.createDocumentFragment(),o=0;o<t.children.length;o++)i.appendChild(e(t.children[o]));n.appendChild(i)}t.elm=n;return n}(t),e),e.parentNode.removeChild(e)},astToVDom:S,contentReplacement:function(e,t){D={},E=t;for(var n=0;n<t.length;n++){var r=t[n].text,i=o(e,r=r.replace(new RegExp(x),"").replace(new RegExp(w),""));D[r]?D[r].mapper.push(n):D[r]={name:r,mapper:[n],value:i},t[n].text=i}},contentUpdate:M,watchRender:F,instruction:I});e.diff=t,e.parser=N,e.plugins=I,e.reactive=b,Object.defineProperty(e,"__esModule",{value:!0})});
