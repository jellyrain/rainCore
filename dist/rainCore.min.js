!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).rainCore={})}(this,(function(e){"use strict";const t="__isReactive",n="__raw";function r(e){return"object"==typeof e&&null!=e}function o(e){return!(!e||!e.__isReactive)}function s(e){return!(!e||!e.__isRef)}function i(e,t){return e!==t&&!(Number.isNaN(e)||Number.isNaN(t))}const c=[];let l;function u(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=()=>{try{return c.push(n),l=n,e()}finally{c.pop(),l=c[c.length-1]}};return t.lazy||n(),n.scheduler=t.scheduler,n}const a=new WeakMap;function f(e,t){if(!l)return;let n=a.get(e);n||a.set(e,n=new Map);let r=n.get(t);r||n.set(t,r=new Set),l.deps=r,r.add(l)}function p(e,t,n){const r=a.get(e);if(!r)return;const o=r.get(t);o&&o.forEach((e=>{e.scheduler?e.scheduler(e,n):e()}))}const d=new WeakMap;function h(e){return r(e)?o(e)?e:d.has(e)?d.get(e):function(e){const o=e,s=new Proxy(e,{get(e,s,i){if(s===t)return!0;if(s===n)return o;const c=Reflect.get(e,s,i);return f(e,s),r(c)?h(c):c},set(e,t,n,r){const o=e[t],s=e.length,c=Reflect.set(e,t,n,r);return i(o,n)&&(p(e,t,n),function(e){return Array.isArray(e)}(e)&&e.length!==s&&p(e,"length")),c}});return d.set(e,s),s}(e):e}class m{constructor(e){this.__isRef=!0,this.__rawValue=e,this._value=g(e)}get value(){return f(this,"value"),this._value}set value(e){i(this._value,e)&&(this._value=g(e),this.__rawValue=e,p(this,"value",e))}}function g(e){return r(e)?h(e):e}class E{constructor(e,t){this._setter=t,this._value=void 0,this._dirty=!0,this.effect=u(e,{lazy:!0,scheduler:()=>{this._dirty||(this._dirty=!0,p(this,"value",this._value))}})}get value(){return this._dirty&&(this._value=this.effect(),this._dirty=!1,f(this,"value")),this._value}set value(e){this._setter(e)}}const y=1,T=2,v=4,x=8,b=16,N=32,S=Symbol("Text"),I=Symbol("Fragment");function O(e){return"string"==typeof e}function $(e){return"number"==typeof e}function _(e){return"object"==typeof e&&null!=e}function R(e){return Array.isArray(e)}const L=/[A-Z]|^(value|checked|selected|muted|disabled)$/;function M(e,t,n){let r=function(e){return O(e)?y:e===S?T:e===I?v:x}(e);return(O(n)||$(n))&&(r|=b,n=n.toString()),R(n)&&(r|=N),{type:e,props:t,children:n,shapeFlag:r,elm:null,anchor:null,key:t&&t.key,component:null}}function k(e){return Array.isArray(e)?M(I,null,e):_(e)?e:M(S,null,e.toString())}function w(e,t){const{type:n,props:r}=t,o=e.props={},s=e.attrs={};for(const e in r)n.props?.includes(e)?o[e]=r[e]:s[e]=r[e];e.props=h(e.props)}function C(e,t){Object.keys(e.attrs).length&&(t.props={...t.props,...e.attrs})}const P=[];let A=!1;const X=Promise.resolve();function F(e){P.length&&P.includes(e)||(P.push(e),A||(A=!0,X.then(j)))}function j(){try{for(let e=0;e<P.length;e++)P[e]()}finally{P.length=0,A=!1}}function V(e,t,n){e.forEach((e=>{z(null,e,t,n)}))}function W(e,t,n,r){e?function(e,t){t.component=e.component,t.component.next=t,t.component.update()}(e,t):function(e,t,n){const{type:r}=e,o=e.component={props:{},attrs:{},setupState:null,ctx:null,update:null,isMounted:!1,subTree:null,next:null};w(o,e),o.setupState=r.setup?.(o.props,{attrs:o.attrs}),o.ctx={...o.props,...o.setupState},o.update=u((()=>{if(o.isMounted){o.next&&(e=o.next,o.next=null,w(o,e),o.ctx={...o.props,...o.setupState});const s=o.subTree,i=o.subTree=k(r.render(o.ctx));C(o,i),z(s,i,t,n),e.elm=i.elm}else{const s=o.subTree=k(r.render(o.ctx));C(o,s),z(null,s,t,n),o.isMounted=!0,e.elm=s.elm}}),{scheduler:F})}(t,n,r)}function B(e,t,n,r){e?(e.elm?.textContent!==t.children&&(e.elm.textContent=t.children),t.elm=e.elm):function(e,t,n){const r=document.createTextNode(e.children);e.elm=r,t.insertBefore(r,n)}(t,n,r)}function D(e,t,n,r){e?function(e,t){t.elm=e.elm,H(e.props,t.props,t.elm),Z(e,t,t.elm)}(e,t):function(e,t,n){const{type:r,props:o,shapeFlag:s,children:i}=e,c=document.createElement(r);o&&H(null,o,c),s&b&&(c.textContent=e.children),s&N&&V(i,c),e.elm=c,t.insertBefore(c,n)}(t,n,r)}function q(e){const{shapeFlag:t}=e;t&x?function(e){q(e.component.subTree)}(e):t&v?function(e){let{elm:t,anchor:n}=e;const r=t.parentNode;for(;t!==n;){const e=t.nextSibling;r.removeChild(t),t=e}r.removeChild(n)}(e):function(e){const{elm:t}=e;t.parentNode.removeChild(t)}(e)}function U(e){e.forEach((e=>{q(e)}))}function z(e,t,n,r){e&&!function(e,t){return e.type===t.type}(e,t)&&(r=(e.anchor||e.elm).nextSibling,q(e),e=null);const{shapeFlag:o}=t;o&x&&W(e,t,n,r),o&T&&B(e,t,n,r),o&v&&function(e,t,n,r){const o=t.elm=e?e.elm:document.createTextNode(""),s=t.anchor=e?e.anchor:document.createTextNode("");e?Z(e,t,n,s):(n.insertBefore(o,r),n.insertBefore(s,r),V(t.children,n,s))}(e,t,n,r),o&y&&D(e,t,n,r)}function H(e,t,n){if(e!==t){e=e||{},t=t||{};for(const r in t){if("key"===r)continue;const o=e[r],s=t[r];o!==s&&J(n,r,o,s)}for(const r in e)"key"===r||r in t||J(n,r,e[r],null)}}function J(e,t,n,r){switch(t){case"class":if(_(r)){let e="";for(t in r)r[t]&&(e=e+t+" ");r=e.trim()}e.className=r||"";break;case"style":if(r){if(O(r)){let e=r;const t={};e=e.split(";"),e.forEach((e=>{const n=e.split(":");2===n.length&&(t[n[0].trim()]=n[1].trim())})),r=t}for(const t in r)e.style[t]=r[t];if(n)for(const t in n)null==r[t]&&(e.style[t]="")}else e.removeAttribute("style");break;default:if(/^on[^a-z]/.test(t)){if(n!==r){const o=t.slice(2).toLowerCase();n&&e.removeEventListener(o,n),r&&e.addEventListener(o,r)}}else L.test(t)?(""===r&&"boolean"==typeof e[t]&&(r=!0),e[t]=r):null==r||!1===r?e.removeAttribute(t):e.setAttribute(t,r)}}function Z(e,t,n,r){const{shapeFlag:o,children:s}=e,{shapeFlag:i,children:c}=t;i&b?(o&N&&U(s),c!==s&&(n.textContent=c)):i&N?o&N?function(e,t){let n=0,r=0;return e.forEach((e=>{e&&null!=e.key&&n++})),t.forEach((e=>{e&&null!=e.key&&r++})),n===e.length&&r===t.length}(s,c)?function(e,t,n,r){let o=0,s=e.length-1,i=t.length-1;for(;o<=s&&o<=i&&e[o].key===t[o].key;)z(e[o],t[o],n,r),o++;for(;o<=s&&o<=i&&e[s].key===t[i].key;)z(e[s],t[i],n,r),s--,i--;if(o>s){const e=i+1,s=t[e]&&t[e].elm||r;for(let e=o;e<=i;e++)z(null,t[e],n,s)}if(o>i)for(let t=o;t<=s;t++)q(e[t]);if(o<=s&&o<=i){const c=new Map;for(let t=o;t<=s;t++)c.set(e[t].key,{prev:e[t],index:t});let l=0,u=!1;const a=[],f=new Array(i-o+1).fill(-1);for(let e=0;e<i-o+1;e++){const s=t[e+o];if(c.has(s.key)){const{prev:t,index:o}=c.get(s.key);z(t,s,n,r),o<l?u=!0:l=o,f[e]=o,c.delete(s.key)}else a.push(e+o)}if(c.forEach((e=>{let{prev:t}=e;q(t)})),u){const e=function(e){const t=[],n=[];for(let r=0;r<e.length;r++)if(-1!==e[r])if(e[r]>t[t.length-1])t.push(e[r]),n.push(t.length-1);else{let o=0,s=t.length-1;for(;o<=s;){const n=~~((o+s)/2);if(e[r]>t[n])o=n+1;else{if(!(e[r]<t[n])){o=n;break}s=n-1}}t[o]=e[r],n.push(o)}let r=t.length-1;for(let e=n.length-1;e>=0&&r>=0;e--)n[e]===r&&(t[r--]=e);return t}(f);let s=e.length-1;for(let i=f.length-1;i>=0;i--)if(i===e[s])s--;else{const e=i+o,s=e+1,c=t[s]&&t[s].elm||r;-1===f[i]?z(null,t[e],n,c):n.insertBefore(t[e].elm,c)}}else if(a.length)for(let e=a.length-1;e>=0;e++){const o=a[e],s=o+1,i=t[s]&&t[s].elm||r;z(null,t[o],n,i)}}}(s,c,n,r):function(e,t,n,r){const o=e.length,s=t.length,i=Math.min(o,s);for(let o=0;o<i;o++)z(e[o],t[o],n,r);s>o&&V(t.slice(i),n,r);s<o&&U(e.slice(i))}(s,c,n,r):(n.textContent=null,V(c,n,r)):(o&b&&(n.textContent=null),o&N&&U(s))}function G(e,t){const n=t._vNode;e?z(n,e,t):n&&q(n),t._vNode=e}function K(e){const t=e.split(",").reduce(((e,t)=>(e[t]=!0,e)),Object.create(null));return e=>!!t[e]}const Q=K("html,body,base,head,link,meta,style,title,address,article,aside,footer,header,h1,h2,h3,h4,h5,h6,hgroup,nav,section,div,dd,dl,dt,figcaption,figure,picture,hr,img,li,main,ol,p,pre,ul,a,b,abbr,bdi,bdo,br,cite,code,data,dfn,em,i,kbd,mark,q,rp,rt,rtc,ruby,s,samp,small,span,strong,sub,sup,time,u,var,wbr,area,audio,map,track,video,embed,object,param,source,canvas,script,noscript,del,ins,caption,col,colgroup,table,thead,tbody,td,th,tr,button,datalist,fieldset,form,input,label,legend,meter,optgroup,option,output,progress,select,textarea,details,dialog,menu,summary,template,blockquote,iframe,tfoot"),Y=K("area,base,br,col,embed,hr,img,input,link,meta,param,source,track,wbr");function ee(e,t){const{source:n}=e;e.source=n.slice(t)}function te(e){const t=/^[\t\r\n\f ]+/.exec(e.source);t&&ee(e,t[0].length)}function ne(e){const t=e.source;return!t||t.startsWith("</")}function re(e,t){const n=e.source.slice(0,t);return ee(e,t),n}var oe,se;function ie(e){const t=function(e){return{options:{delimiters:["{{","}}"],isNativeTag:Q,isVoidTag:Y},source:e}}(e);return n=ce(t),{type:oe.ROOT,children:n};var n}function ce(e){const t=[];for(;!ne(e);){const n=e.source;let r;r=n.startsWith(e.options.delimiters[0])?le(e):n.startsWith("<")?ue(e):pe(e),t.push(r)}let n=!1;for(let e=0;e<t.length;e++){const r=t[e];if(r.type===oe.TEXT)if(/[^\t\r\n\f ]/.test(r.content))r.content=r.content.replace(/[\t\r\n\f ]+/g," ");else{const o=t[e-1],s=t[e+1];!o||!s||o.type===oe.ELEMENT&&s.type===oe.ELEMENT&&/[\r\n]/.test(r.content)?(n=!0,t[e]=null):r.content=" "}}return n?t.filter(Boolean):t}function le(e){const[t,n]=e.options.delimiters;ee(e,t.length);const r=e.source.indexOf(n),o=re(e,r).trim();return ee(e,n.length),{type:oe.INTERPOLATION,content:{type:oe.SIMPLE_EXPRESSION,content:o,isStatic:!1}}}function ue(e){const t=ae(e);return t.isSelfClosing||e.options.isVoidTag(t.tag)||(t.children=ce(e),ae(e)),t}function ae(e){const t=/^<\/?([a-z][^\t\r\n\f />]*)/i.exec(e.source),n=t[1];ee(e,t[0].length),te(e);const r=e.options.isNativeTag(n)?se.ELEMENT:se.COMPONENT,{props:o,directives:s}=function(e){const t=[],n=[];for(;e.source.length&&!e.source.startsWith(">")&&!e.source.startsWith("/>");){let r=fe(e);r.type===oe.DIRECTIVE?n.push(r):t.push(r)}return{props:t,directives:n}}(e),i=e.source.startsWith("/>");return ee(e,i?2:1),{type:oe.ELEMENT,tag:n,tagType:r,props:o,directives:s,isSelfClosing:i,children:[]}}function fe(e){const t=/^[^\t\r\n\f />][^\t\r\n\f />=]*/.exec(e.source)[0];let n;if(ee(e,t.length),te(e),"="===e.source[0]&&(ee(e,1),te(e),n=function(e){const t=e.source[0];ee(e,1);const n=e.source.indexOf(t),r=re(e,n);return ee(e,1),r}(e),te(e)),/^(r-|@|:)/.test(t)){let e,o;return":"===t[0]&&(e="bind",o=t.slice(1)),"@"===t[0]&&(e="on",o=t.slice(1)),t.startsWith("r-")&&([e,o]=t.slice(2).split(":")),{type:oe.DIRECTIVE,name:e,arg:o&&{type:oe.SIMPLE_EXPRESSION,content:(r=o,r.replace(/-(\w)/g,((e,t)=>t?t.toUpperCase():""))),isStatic:!0},exp:n&&{type:oe.SIMPLE_EXPRESSION,content:n,isStatic:!1}}}var r;return{type:oe.ATTRIBUTE,name:t,value:n&&{type:oe.TEXT,content:n}}}function pe(e){const{delimiters:t}=e.options,n=/\<[^\<\>]+(\<[^\<\>]+\>)/,r=new RegExp(`${t[0]}[^${t[0]}${t[1]}]+(${t[0]}[^${t[0]}${t[1]}]+${t[1]})`);let o=e.source.length;if(n.test(e.source)){const t=e.source.indexOf(n.exec(e.source)[1]);-1!==t&&o>t&&(o=t)}else{const t=e.source.indexOf("<");-1!==t&&o>t&&(o=t)}if(r.test(e.source)){const t=e.source.indexOf(r.exec(e.source)[1]);-1!==t&&o>t&&(o=t)}else{const n=e.source.indexOf(t[0]);-1!==n&&o>n&&(o=n)}const s=re(e,o);return{type:oe.TEXT,content:s}}function de(e,t){return e.map((e=>{switch(e.name){case"bind":return`${e.arg.content}: ${Te(e.exp)}`;case"on":let n=e.exp.content,r=e.exp.content;return!/(\+|\-|\*|\/)/.test(n)||n.includes("=>")||n.includes("function")||(r=`$event => (${n})`),/\([^\)]*?\)$/.test(n)&&(/^(\$event)/.test(r)||(r=`$event => (${n})`)),`on${t=e.arg.content,t[0].toUpperCase()+t.slice(1)}: ${r}`;default:return`${e.name}: ${Te(e.exp)}`}var t}))}function he(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const r=e.findIndex((e=>e.name===t)),o=e[r];return r>-1&&n&&e.splice(r,1),o}function me(e,t){switch(e.type){case oe.ROOT:return Ee(e);case oe.ELEMENT:return ge(e,t);case oe.INTERPOLATION:return function(e){return`h(Text, null, ${Te(e.content)})`}(e);case oe.TEXT:return ye(e)}}function ge(e,t){const n=he(e.directives,"if")||he(e.directives,"else-if");if(n)return function(e,t,n){const{exp:r}=e,o=ge(t,n);let s;const{children:i}=n;for(let e=i.findIndex((e=>e===t))+1;e<i.length;e++){const t=i[e];if(t.type!==oe.TEXT||t.content.trim()){t.type===oe.ELEMENT&&(he(t.directives,"else")||he(t.directives,"else-if",!1))&&(s=ge(t,n),i.splice(e,1));break}i.splice(e,1),e--}return`${r.content} ? ${o} : ${s||ye()}`}(n,e,t);const r=he(e.directives,"model");r&&function(e,t){t.directives.push({type:oe.DIRECTIVE,name:"bind",exp:e.exp,arg:{type:oe.SIMPLE_EXPRESSION,content:"value",isStatic:!0}},{type:oe.DIRECTIVE,name:"on",exp:{type:oe.SIMPLE_EXPRESSION,content:`($event) => ${e.exp.content} = $event.target.value`,isStatic:!1},arg:{type:oe.SIMPLE_EXPRESSION,content:"input",isStatic:!0}})}(r,e);const o=he(e.directives,"for");return o?function(e,t){const{exp:n}=e,[r,o]=n.content.split(/\sin\s|\sof\s/);return`h(Fragment, null, renderList(${o.trim()}, ${r.trim()} => ${ge(t)}))`}(o,e):function(e){const t=e.tagType===se.ELEMENT?`"${e.tag}"`:`resolveComponent("${e.tag}")`,n=function(e){const{props:t,directives:n}=e;return[...t.map((e=>`${e.name}: ${Te(e.value)}`)),...de(n)]}(e),r=n.length?`{ ${n.join(", ")} }`:null,o=e.children.length?Ee(e):null;return`h(${t}, ${r}, ${o})`}(e)}function Ee(e){const{children:t}=e,n=[];for(let r=0;r<t.length;r++)n.push(me(t[r],e));return`[${n.join(", ")}]`}function ye(e){return`h(Text, null, ${Te(e)})`}function Te(){let{isStatic:e=!0,content:t=""}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e?JSON.stringify(t):t}function ve(e){return function(e){return`\n    const { h, Text, Fragment, renderList, resolveComponent } = rainCore\n        with(ctx) {\n            return ${me(e)}\n        }\n   `}(ie(e))}let xe;!function(e){e.ROOT="ROOT",e.ELEMENT="ELEMENT",e.TEXT="TEXT",e.SIMPLE_EXPRESSION="SIMPLE_EXPRESSION",e.INTERPOLATION="INTERPOLATION",e.ATTRIBUTE="ATTRIBUTE",e.DIRECTIVE="DIRECTIVE"}(oe||(oe={})),function(e){e.ELEMENT="ELEMENT",e.COMPONENT="COMPONENT"}(se||(se={})),e.Fragment=I,e.Text=S,e.compile=ve,e.computed=function(e){let t,n;var r;return"function"==typeof(r=e)&&null!=r?(t=e,n=()=>{console.warn("Write operation failed: computed value is readonly")}):(t=e.get,n=e.set),new E(t,n)},e.createApp=function(e){if(xe=e.components||{},!e.render&&e.template){if("#"===e.template[0]){const t=document.querySelector(e.template);t&&(e.template=t.innerHTML)}e.render=new Function("ctx",ve(e.template))}return{mount(t){O(t)&&(t=document.querySelector(t)),e.render||e.template||(e.template=t.innerHTML,e.render=new Function("ctx",ve(e.template)),t.innerHTML=""),G(M(e,null,null),t)}}},e.h=M,e.isReactive=o,e.isRef=s,e.parse=ie,e.reactive=h,e.ref=function(e){return s(e)?e:new m(e)},e.render=G,e.renderList=function(e,t){const n=[];if($(e)){for(let r=0;r<e;r++)n.push(t(r+1,r));return n}if(R(e)||O(e)){for(let r=0;r<e.length;r++)n.push(t(e[r],r));return n}if(_(e)){return Object.keys(e).forEach(((r,o)=>{n.push(t(e[r],r,o))})),n}return n},e.resolveComponent=function(e){let t;if(Object.keys(xe).findIndex((n=>{n.toLowerCase()===e.toLowerCase()&&(t=xe[n])})),!t.render&&t.template){if("#"===t.template[0]){const e=document.querySelector(t.template);e&&(t.template=e.innerHTML)}t.render=new Function("ctx",ve(t.template))}return t},e.toRaw=function(e){if(o(e))return e[n]},e.unRef=function(e){return s(e)?e.value:e},e.watch=function(e,t){let n=s(e)?e.value:e(),r=u((()=>s(e)?e.value:e()),{scheduler:(e,r)=>{t(r,n),n=r}});const o=r.deps;return function(){o.delete(r),r=null,n=null}},e.watchEffect=function(e){let t=u(e);const n=t.deps;return function(){n.delete(t),t=null}},Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=rainCore.min.js.map
