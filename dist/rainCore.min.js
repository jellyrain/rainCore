!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).rainCore={})}(this,function(t){"use strict";function m(t){var e=document.createElement(t.sel);if(t.data!=={})for(var n in t.data)e.setAttribute(n,t.data[n]);if(null!=t.text&&(e.innerText=t.text),t.children!==[]){for(var r=document.createDocumentFragment(),o=0;o<t.children.length;o++)r.appendChild(m(t.children[o]));e.appendChild(r)}return t.elm=e}function r(t,e,n,r){return null!=n?"string"==typeof n&&(r=n,n=[]):n=[],null!=e?"string"==typeof e?(r=e,e={}):e.constructor===Array&&(n=e,e={}):e={},{sel:t,data:e,children:n,elm:void 0,text:r,key:null==e?void 0:e.key}}function _(t,e){return t.sel===e.sel&&t.key===e.key}function n(t,e){t.parentNode.insertBefore(e,t),t.parentNode.removeChild(t)}function y(t,e){if(t!==e){if(null==e.text||null!=e.children&&0!==e.children.length)if(null!=t.children&&0<t.children.length)!function(t,e,n){for(var r=0,o=0,i=e.length-1,a=n.length-1,u=e[r],l=e[i],s=n[o],c=n[a],p=null;r<=i&&o<=a;)if(null!=e[r]&&null!=u)if(null!=e[i]&&null!=l)if(null!=n[o]&&null!=s)if(null!=n[a]&&null!=c)if(_(u,s))y(u,s),u=e[++r],s=n[++o];else if(_(l,c))y(l,c),l=e[--i],c=n[--a];else if(_(u,c))y(u,c),t.insertBefore(u.elm,l.elm.nextSibling),u=e[++r],c=n[--a];else if(_(l,s))y(l,s),t.insertBefore(l,u.elm),l=e[--i],s=n[++o];else{if(!p)for(var p={},h=r;h<=i;h++){var f=e[h].key;null!=f&&(p[f]=h)}var d,v=p[o.key];null==v?t.insertBefore(m(s),u.elm):(y(d=e[v],s),e[v]=void 0,t.insertBefore(d.elm,u.elm)),s=n[++a]}else c=n[--a];else s=n[++o];else l=e[--i];else u=e[++r];if(o<=a)for(h=o;h<=a;h++)t.insertBefore(m(n[h]),null==e[r]?null:e[r].elm);if(r<=i)for(h=r;h<=i;h++)e[h]&&t.removeChild(e[h].elm)}(t.elm,t.children,e.children);else{t.elm.innerHTML="";for(var n=document.createDocumentFragment(),r=0;r<e.children.length;r++)n.appendChild(m(e.children[r]));t.elm.appendChild(n)}else t.text!==e.text&&(t.elm.innerText=e.text);if(e.data!=={})if(t.data!=={}){for(var o in e.data)t.data[o]&&(t.data[o]=void 0),t.elm.setAttribute(o,e.data[o]);for(var o in t.data)t.data[o]&&t.elm.removeAttribute(o)}else for(var o in e.data)t.elm.setAttribute(o,e.data[o]);else if(t.data!=={})for(var o in t.data)t.elm.removeAttribute(o);e.elm=t.elm}}function a(t,e){_(t,e)?y(t,e):n(t.elm,m(e))}var e=Object.freeze({__proto__:null,h:r,mountNode:function(t,e){n(t,m(e))},patch:a});function i(t,e){for(var n=t,r=e.split("."),o=0;o<r.length;o++)n=n[r[o]];return n}function o(t){for(var e="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",n="",r=0;r<t;r++)n+=e[Math.floor(Math.random()*e.length)];return n}function u(t,e){for(var n=[],r=0;r<t.length;r++)n.push(e(t[r],r,t));return n}var l,s=[];function c(t,e,n){this.data=t,this.key=e,this.callback=n,this.deps={},this.value=this.get()}function p(){this.id=o(8),this.subs=[]}function h(t,e,n){n=n||t[e];var r=new p,o=f(n);Object.defineProperty(t,e,{get:function(){return r.depend(),o&&(o.dep.depend(),n.constructor===Array&&function t(e){for(var n=0;n<e.length;n++)e[n]&&e[n].__ob__&&e[n].__ob__.dep.depend(),e[n].constructor===Array&&t(e[n])}(n)),n},set:function(t){t!==n&&(o=f(n=t),r.notify())}})}function f(t){if("object"==typeof t)return t.__ob__&&t.__ob__ instanceof d?t.__ob__:new d(t)}function d(t){this._data=t,this.def(),this._data.constructor===Array?(this.proxyPrototype(),this.array()):this.walk()}c.prototype.get=function(){t=this,s.push(l),l=t;var t=i(this.data,this.key);return l=s.pop(),t},c.prototype.addDep=function(t){t.id in this.deps||(this.deps[t.id]=t).addSub(l)},c.prototype.update=function(){var t=this.value;this.value=i(this.data,this.key),this.callback(this.value,t,this.data)},c.prototype.remove=function(){for(var t in this.deps)this.deps[t].removeSub(this)},p.prototype.addSub=function(t){this.subs.push(t)},p.prototype.depend=function(){l&&l.addDep(this)},p.prototype.notify=function(){for(var t=0;t<this.subs.length;t++)this.subs[t].update()},p.prototype.removeSub=function(t){t=function(t,e){for(var n=0;n<t.length;n++)if(e===t[n])return n;return-1}(this.subs,t);-1<t&&this.subs.splice(t,1)},d.prototype.walk=function(){for(var t in this._data)h(this._data,t)},d.prototype.array=function(){for(var t=0;t<this._data.length;t++)f(this._data[t])},d.prototype.proxyPrototype=function(){var n=Array.prototype,t=["push","pop","shift","unshift","splice","reverse","sort"],r={};r.__proto__=n;for(var e=0;e<t.length;e++)!function(e){Object.defineProperty(r,e,{value:function(){var t=n[e].apply(this,arguments);return"push"!==e&&"unshift"!==e||this.__ob__.array(arguments),"splice"===e&&this.__ob__.array(arguments.slice(2)),this.__ob__.dep.notify(),t},enumerable:!1,writable:!0,configurable:!0})}(t[e]);this._data.__proto__=r},d.prototype.def=function(){this.dep=new p,Object.defineProperty(this._data,"__ob__",{value:this,enumerable:!1,writable:!0,configurable:!0})};var v={};function b(t,e,n){e=new c(t,e,n),n=o(8);return v[n]=e,n}var g=Object.freeze({__proto__:null,watch:b,remove:function(t){if(t)v[t].remove(),delete v[t];else{for(key in v)v[key].remove();v={}}},observer:f}),w="{{",x="}}",A="r",k=!1;function j(t){return k||(w=u(w.split(""),function(t){return"\\"+t}).join(""),x=u(x.split(""),function(t){return"\\"+t}).join(""),k=!0),new RegExp(w+".+"+x).test(t)}var P=[],R=[],B=[];function C(t){for(P=[],R=[],B=[],t=function(t){t=t.trim();return t=t.replace(/\>(\s+)\</g,"><")}(t);t.length;){var e,n;/(^\<[^\/][^\<\>]*[^\/]\>)|(^\<.\>)/.test(t)?(n=E(t.match(/(^\<[^\/][^\<\>]*[^\/]\>)|(^\<.\>)/)[0]),P.push(n),t=t.replace(/(^\<[^\/][^\<\>]*[^\/]\>)|(^\<.\>)/,"")):/^\<[^\/][^\<\>]*\/\>/.test(t)?(n=E(t.match(/^\<[^\/][^\<\>]*\/\>/)[0]),(1<P.length?P[P.length-1].children:P).push(n),t=t.replace(/^\<[^\/][^\<\>]*\/\>/,"")):/^[^\<]+</.test(t)?null!=(e=t.match(/^[^\<]+</))&&(j(e)&&R.push(P[P.length-1]),e=e[0].slice(0,-1),P[P.length-1].text=e,t=t.replace(/^[^\<]+</,"<")):/^\<\/[^\<\>]+\>/.test(t)&&(1<P.length&&(n=P.pop(),P[P.length-1].children.push(n)),t=t.replace(/^\<\/[^\<\>]+\>/,""))}return{ast:P[0],mapperContentAst:R,mapperInstructionAst:B}}function E(t){var e=t.replace(/\<|\>/g,""),t={children:[],text:void 0};t.sel=e.match(/^\w+/)[0],t.data=function(t,e){var n={},r=!1,o=(t=t.replace(/\s*\//,"")).replace(/^\w+(\s+)?/,"").replace(/(\'|\")\s+/g,"=").replace(/(\'|\")/g,"");if(""===o||null==o)return n;o=o.split("=");for(var i=0;i<o.length;i+=2)!function(t){return new RegExp(A+"-").test(t)}(o[i])||(r=!0),n[o[i]]=o[i+1];r&&B.push(e);return n}(e,t);for(var n=[],r=0;r<P.length;r++)n.push(P[r].children.length);return t.path=n,t}var O,D,S=Object.freeze({__proto__:null,parser:C,setContentReplacementTags:function(t,e){w=t,x=e},setInstructionHeader:function(t){A=t}});function z(t){for(var e=[],n=0;n<t.children.length;n++)e.push(z(t.children[n]));return r(t.sel,t.data,e,t.text)}function T(t,e){O={},D=e;for(var n=0;n<e.length;n++){var r=e[n].text,o=i(t,r=r.replace(new RegExp(w),"").replace(new RegExp(x),""));O[r]?O[r].mapper.push(n):O[r]={name:r,mapper:[n],value:o},e[n].text=o}}function N(t,e){if(O[t]&&O[t].value!==e){for(var n=O[t].mapper,r=0;r<n.length;r++)D[n[r]].text=e;O[t].value=e}}var J,L,M,F=Object.freeze({__proto__:null,contentReplacement:T,contentUpdate:N});function H(t,e,n,r){b(t,e,function(t){N(e,t);t=z(n);a(r,t),r=t})}var I=Object.freeze({__proto__:null,registrationInstruction:function(t,e,n){J=t,L=e,M=n},model:function(t){for(var e=0;e<t.length;e++){var n,r=t[e].data[A+"-model"];r&&(H(J,r,L,M),(n=function(t,e){for(var n=t,r=0;r<e.length;r++)n=n.children[e[r]];return n}(M,t[e].path).elm).addEventListener("input",function(){!function(t,e){for(var n=obj,r=e.split("."),o=0;o<r.length;o++)o===r.length-1?n[r[o]]=t.target.value:n=n[r[o]]}(event,r)}),n.value=i(J,r),n.removeAttribute(A+"-model"),delete t[e].data[A+"-model"])}}}),U={};function V(){window.onhashchange=function(){var t;t=location.hash.slice(1)||"/",U[t].callback&&U[t].callback()}}function q(t){U[t.path]=t}function G(t){location.hash="#"+t}var K=Object.freeze({__proto__:null,hash:V,route:q,routeJump:G});function Q(){this.init()}Q.prototype.init=function(){this.template={},this.routeProps={},this.interceptorsBefore=[],this.interceptorsAfter=[],window.onload=function(){V()}},Q.prototype.bind=function(t,e){this.vDom=t,this._data=e},Q.prototype.route=function(t){var i;return this.template[t.path]=t.template,q({path:t.path,callback:(i=this,function(){for(var t=location.hash.slice(1)||"/",e=i.template[t],n=i.routeProps[t],r=i._data,o=0;o<i.interceptorsBefore.length;o++)i.interceptorsBefore[o](e,n,r);e&&(t=C(e),r&&T(r,t.mapperContentAst),t=z(t.ast),a(i.vDom,t),i.vDom=t);for(o=0;o<i.interceptorsAfter.length;o++)i.interceptorsAfter[o](e,n,r)})}),this},Q.prototype.routeJump=function(t,e,n){"function"==typeof e&&(n=e,e=void 0),n(t,e),this.routeProps[t]=e,G(t)},Q.prototype.routeProp=function(){var t=location.hash.slice(1)||"/";return this.routeProps[t]},Q.prototype.before=function(t){return this.interceptorsBefore.push(t),this},Q.prototype.after=function(t){return this.interceptorsAfter.push(t),this};var W={};function X(){var n,r;history.pushState=(n="pushState",r=history[n],function(){var t=r.apply(this,arguments),e=new Event(n);return e.arguments=arguments,window.dispatchEvent(e),t}),window.addEventListener("popstate",function(){$()}),window.addEventListener("pushState",function(){$()})}function Y(t){W[t.path]=t}function Z(t){history.pushState(null,null,t)}function $(){var t=location.pathname;W[t].callback&&W[t].callback()}var tt=Object.freeze({__proto__:null,History:X,route:Y,routeJump:Z});function et(){this.init()}et.prototype.init=function(){this.template={},this.routeProps={},this.interceptorsBefore=[],this.interceptorsAfter=[],window.onload=function(){X()}},et.prototype.bind=function(t,e){this.vDom=t,this._data=e},et.prototype.route=function(t){var i;return this.template[t.path]=t.template,Y({path:t.path,callback:(i=this,function(){for(var t=location.hash.slice(1)||"/",e=i.template[t],n=i.routeProps[t],r=i._data,o=0;o<i.interceptorsBefore.length;o++)i.interceptorsBefore[o](e,n,r);e&&(t=C(e),r&&T(r,t.mapperContentAst),t=z(t.ast),a(i.vDom,t),i.vDom=t);for(o=0;o<i.interceptorsAfter.length;o++)i.interceptorsAfter[o](e,n,r)})}),this},et.prototype.routeJump=function(t,e,n){"function"==typeof e&&(n=e,e=void 0),n(t,e),this.routeProps[t]=e,Z(t)},et.prototype.routeProp=function(){var t=location.hash.slice(1)||"/";return this.routeProps[t]},et.prototype.before=function(t){return this.interceptorsBefore.push(t),this},et.prototype.after=function(t){return this.interceptorsAfter.push(t),this};var nt={};function rt(t){for(var e in t)nt[e]=t[e]}var ot={};function it(t,e){ot[t]=e}function at(t){ot[t](nt)}var ut=Object.freeze({__proto__:null,addState:rt,setState:function(t,e){nt[t]=e},dispatch:it,commit:at});function lt(t){this.init(t)}lt.prototype.init=function(t){this.watchReducer={},rt(t.state);for(var e=0;e<t.reducer.length;e++){var n=t.reducer[e];this.dispatch(n.key,n.callback)}},lt.prototype.dispatch=function(t,e){return this.watchReducer[t]=[],it(t,e),this},lt.prototype.commit=function(t){at(t);for(var e=0;e<this.watchReducer[t].length;e++)this.watchReducer[t][e]()},lt.prototype.subscribe=function(t,e){return this.watchReducer[t]&&this.watchReducer[t].push(e),this};I=Object.freeze({__proto__:null,astToDom:function(t,e){t.parentNode.insertBefore(function t(e){var n=document.createElement(e.sel);if(e.data!=={})for(var r in e.data)n.setAttribute(r,e.data[r]);null!=e.text&&(n.innerText=e.text);if(e.children!==[]){for(var o=document.createDocumentFragment(),i=0;i<e.children.length;i++)o.appendChild(t(e.children[i]));n.appendChild(o)}e.elm=n;return n}(e),t),t.parentNode.removeChild(t)},astToVDom:z,contentParser:F,watchRender:H,instruction:I,hashRouterExtend:Q,historyRouterExtend:et,stateExtend:lt}),tt=Object.freeze({__proto__:null,hashRouter:K,historyRouter:tt});t.diff=e,t.parser=S,t.plugins=I,t.reactive=g,t.router=tt,t.state=ut,Object.defineProperty(t,"__esModule",{value:!0})});
